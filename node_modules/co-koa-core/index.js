"use strict";const Koa=require("koa"),BodyParser=require("koa-bodyparser"),Router=require("koa-router"),serve=require("koa-static");module.exports=function(e,r){const o=require("./lib/Builder"),t=require("./lib/ClientConfigFactory"),i=require("./lib/DependencyManager"),s=require(`${e}/config/middleware`),a=require("./lib/ModelFactory"),l=require("./lib/WelcomeMessage"),n=t(e).build(r);this.launch=(()=>{const r=(new Koa).use(BodyParser()),t=new Router;l(n).sayHello(),r.use(serve("public"));const u=i(n);if(a(n).build(u.call),n.useHBS){const o=require(`${e}/config/hbsConfig`),t=require("koa-hbs-renderer");r.use(t(o(n)))}o(n).build("Controller",(e,r)=>{const o=e(u.call);Object.keys(o).forEach(e=>{var i=e.split(" ");try{if(2!==i.length)throw new Error;{const s="index"===r.toLowerCase()?"":`/${r}`;t[i[0].toLowerCase()](s+i[1],o[e])}}catch(r){n.logger.error(`failed to generate action "${e}": is your verb valid?'}`)}})});const c=Object.assign({},s(u.call));return Object.keys(c).forEach(e=>{r.use(c[e])}),require(`${e}/config/bootstrap`).bootstrap(u.call),n.logger.log(`listening on port ${n.env.port}`),{app:r,port:n.env.port,router:t}})};